{"version":3,"sources":["Game.js"],"names":["cc","Class","extends","Component","properties","level","floodPrefab","default","type","Prefab","canvas","Node","move_display","Label","scoreAudio","AudioClip","mode_label","spawnInterval","onLoad","spawnCount","name","rows","limit","initialize","create_table","score","finished","game_level","change_level","colours","Color","BLUE","RED","GREEN","YELLOW","ORANGE","MAGENTA","reset_table","clear_node","row","col","game_table","element","destroy","numberToSpawn","start_table","colour","flooded","num","limit_moves","level_name","moves","updateMoves","string","random_colour","colour_no","Math","floor","random","flood_element","color","flood_neighbours","test_colour_flood","equals","all_flooded","flood","initial","old_colour","max_moves","log","star","spawnNewStarByNum","spawnAllStars","i","j","inum","newcolour","newStar","instantiate","node","addChild","starWidth","width","marginX","marginy","height","x","ynum","y","pos","v2","setPosition","getComponent","game","spawnNewStar","getNewStarPosition","parseInt","new_game","gainScore","gameOver","director","loadScene"],"mappings":"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","file":"Game.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        level:[],\n        floodPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        canvas: {\n            default: null,\n            type: cc.Node\n        },              \n        move_display: {\n            default: null,\n            type: cc.Label\n        },       \n        scoreAudio: {\n            default: null,\n            type: cc.AudioClip\n        },\n        mode_label: {\n            default: null,\n            type: cc.Label\n        },\n        spawnInterval: 0,\n        // rows: 0\n    },\n\n    onLoad: function () { \n        \n        this.spawnCount = 0;       \n        this.level = \n        [\n            {\n                name: \"Normal\",\n                rows:10,\n                limit: 18\n            },\n            {\n                name: \"Hard\",\n                rows:12,\n                limit: 24\n            },\n            {\n                name: \"Hell\",\n                rows:18,\n                limit: 31\n            },\n            {\n                name: \"Extreme\",\n                rows:24,\n                limit: 41\n            }\n        ];\n        this.initialize();\n        this.create_table();\n        \n        this.score = 0;\n    },\n\n    initialize: function()\n    {\n        this.finished = false;\n        this.game_level = 0;\n        this.change_level(this.game_level);      \n\n        this.colours = [cc.Color.BLUE, cc.Color.RED,cc.Color.GREEN,cc.Color.YELLOW,cc.Color.ORANGE,cc.Color.MAGENTA];\n        this.reset_table();\n    },\n\n    clear_node: function()\n    {\n        for (var row = 0; row < this.rows; row++) {            \n            for (var col = 0; col < this.rows; col++) {\n                this.game_table[row][col].element.destroy();\n            }\n        }\n    },\n\n    reset_table: function()\n    {\n        this.numberToSpawn = this.rows * this.rows;        \n        this.start_table = {};        \n        for (var row = 0; row < this.rows; row++) {            \n            this.start_table[row] = {};            \n        }  \n\n        this.game_table = {};\n        for (var row = 0; row < this.rows; row++) {\n            this.game_table[row] = {};\n            for (var col = 0; col < this.rows; col++) {\n                this.game_table[row][col] = {\n                    colour: null,\n                    flooded: false,\n                    element: null\n                };\n            }\n        }\n    },\n\n    change_level: function (num)\n    {\n        // this.canvas.opacity = 255;\n        this.game_level = num;\n        this.rows = this.level[num].rows;\n        this.limit_moves = this.level[num].limit;\n        this.level_name = this.level[num].name;\n        this.moves = 0;\n        this.updateMoves();\n        this.mode_label.string = this.level_name;         \n        this.reset_table();       \n    },\n\n    random_colour: function  ()\n    {        \n        var colour_no = Math.floor (Math.random () * 6);\n        return this.colours[colour_no];\n    },    \n\n    flood_element: function (row, col, colour)\n    {\n        this.game_table[row][col].colour = colour;\n        this.game_table[row][col].element.color = colour;\n    },\n\n    flood_neighbours: function  (row, col, colour)\n    {\n        if (row < this.rows - 1)\n        this.test_colour_flood (row + 1, col, colour);\n        if (row > 0)\n        this.test_colour_flood (row - 1, col, colour);\n        if (col < this.rows - 1)\n        this.test_colour_flood (row, col + 1, colour);\n        if (col > 0)\n        this.test_colour_flood (row, col - 1, colour);\n    },\n\n    test_colour_flood: function  (row, col, colour)\n    {\n        if (this.game_table[row][col].flooded)\n            return;\n        if (this.game_table[row][col].colour.equals(colour)) {\n            this.game_table[row][col].flooded = true;\n            this.flood_neighbours (row, col, colour);\n        }\n    },\n\n    all_flooded: function  ()\n    {\n        for (var row = 0; row < this.rows; row++) {\n            for (var col = 0; col < this.rows; col++) {\n                if (! this.game_table[row][col].flooded) {\n                    return false;\n                }\n            }\n        }\n        return true;\n    },\n\n    flood: function(colour, initial)\n    {\n        if (this.finished)\n            return;\n        var old_colour = this.game_table[0][0].colour;\n        if (! initial && colour == old_colour)\n            return;\n        this.moves++;        \n        \n        for (var row = 0; row < this.rows; row++) \n            for (var col = 0; col < this.rows; col++) \n            {\n                if (this.game_table[row][col].flooded)\n                 {\n                    this.flood_element (row, col, colour);                    \n                 } \n            }      \n        for (var row = 0; row < this.rows; row++)\n            for (var col = 0; col < this.rows; col++)\n                if (this.game_table[row][col].flooded)\n                {\n                    this.flood_neighbours (row, col, colour);\n                }    \n        if (this.all_flooded ()) {\n            this.finished = true;\n            if (this.moves <= this.max_moves) {\n                cc.log (\"You win.\");\n            } else {\n                cc.log (\"Finished, at last!\");\n            }\n        } else if (this.moves == this.max_moves) {\n            cc.log (\"You lost.\");\n        }\n    },\n\n    create_table: function()\n    {\n        this.moves = -1;\n        this.finished = false;        \n        for (var row = 0; row < this.rows; row++) {            \n            for (var col = 0; col < this.rows; col++) \n            {        \n                var colour = this.random_colour();\n                this.game_table[row][col].colour = colour;\n                this.start_table[row][col] = colour;\n                var star = this.spawnNewStarByNum(row, col, row, colour);                \n                this.game_table[row][col].element = star;\n                this.game_table[row][col].flooded = false;\n            }\n        }\n        this.game_table[0][0].flooded = true;\n        this.flood (this.game_table[0][0].colour, true);\n    },\n\n    spawnAllStars: function()\n    {         \n        for(var i = 0; i < this.rows; i++)\n            for(var j = 0; j <= i; j++)\n            {                 \n                var inum = i -j + 1;\n                this.spawnCount++;\n                this.spawnNewStarByNum(i, j, i -j + 1);                \n            }\n        for(var i = 1; i < this.rows; i++)\n            for(var j = i; j < this.rows; j++)\n            {   \n                var inum = this.rows -j + i;     \n                this.spawnCount++; \n                this.spawnNewStarByNum(i, j, this.rows - j + i);              \n            }\n    },\n\n    spawnNewStarByNum: function(i, j, inum, newcolour) {\n              \n        var newStar = cc.instantiate(this.floodPrefab);\n        var color = newStar.color;                \n        newStar.color = newcolour;\n        this.node.addChild(newStar); \n        var starWidth = newStar.width;\n        \n        var marginX = (this.canvas.width - starWidth * this.rows ) / 2;\n        var marginy = (this.canvas.height - starWidth * this.rows ) / 2;              \n\n        var x =  starWidth * inum - this.canvas.width / 2 + starWidth / 2 + marginX;\n        var ynum = (this.spawnCount - (this.spawnCount % this.rows)) * this.rows;\n        var y =  this.canvas.height / 2 - starWidth * j - starWidth / 2  - marginy + 50;\n        var pos = cc.v2( x , y);\n        newStar.setPosition(pos);       \n        \n        newStar.getComponent('Star').game = this;\n        return newStar;   \n    },\n\n    spawnNewStar: function() {\n\n        if (this.spawnCount >= this.numberToSpawn) {\n            return;\n        }\n       \n        var newStar = cc.instantiate(this.floodPrefab);\n        this.node.addChild(newStar);\n        \n        newStar.setPosition(this.getNewStarPosition(newStar.width));\n        //newStar.setPosition(cc.v2(newStar.getPosition().x + newStar.node.width * i, 0));        \n        newStar.getComponent('Star').game = this; \n        this.spawnCount++;\n    },\n\n    getNewStarPosition: function (starWidth) {\n        var marginX = (this.canvas.width - starWidth * this.numberToSpawn / this.rows ) / 2;\n        var marginy = (this.canvas.height - starWidth * this.numberToSpawn / this.rows ) / 2;\n        var x =  starWidth * (this.spawnCount % this.rows) - this.canvas.width / 2 + starWidth / 2 + marginX;\n        var ynum = (this.spawnCount - (this.spawnCount % this.rows)) * this.rows;\n        var y =  this.canvas.height / 2 - starWidth * parseInt(this.spawnCount / this.rows) - starWidth / 2  - marginy;\n        return cc.v2( x , y);\n    },\n\n    new_game: function()\n    {\n        this.create_table();\n    },\n\n    updateMoves: function () {                \n        this.move_display.string = this.moves + \" / \" + this.limit_moves; \n    },\n\n    gainScore: function () {\n        // this.score += 1;        \n        // this.scoreDisplay.string = this.score;        \n        // cc.audioEngine.playEffect(this.scoreAudio, false);\n    },\n\n    gameOver: function () {\n        // this.player.stopAllActions(); \n        cc.director.loadScene('game');\n    }\n});\n"]}